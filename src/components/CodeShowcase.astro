---
import { Code } from 'astro:components';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const ruleCode = `{
  "config": {
    "name": "discount-check",
    "version": "1.0.0",
    "entry_step": "check_vip"
  },
  "steps": {
    "check_vip": {
      "id": "check_vip",
      "name": "Check VIP Status",
      "type": "decision",
      "branches": [
        { 
          "condition": "user.vip == true", 
          "next_step": "vip_discount" 
        }
      ],
      "default_next": "normal_discount"
    },
    "vip_discount": {
      "id": "vip_discount",
      "type": "terminal",
      "result": { "discount": 0.2 }
    },
    "normal_discount": {
      "id": "normal_discount",
      "type": "terminal",
      "result": { "discount": 0.05 }
    }
  }
}`;

const executionResult = `{
  "rule": "discount-check",
  "result": { "discount": 0.2 },
  "trace": [
    { "step": "check_vip", "branch": 0, "condition": "user.vip == true (true)" },
    { "step": "vip_discount", "type": "terminal" }
  ],
  "duration_us": 1.63
}`;
---

<section class="py-24 bg-surface/50 border-y border-white/5 reveal">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col lg:flex-row gap-16 items-center">
      <div class="flex-1">
        <h2 class="text-3xl md:text-4xl font-bold text-white mb-6 font-mono">{t('code.title')}</h2>
        <p class="text-slate-400 mb-8 leading-relaxed">
          {t('code.desc')}
        </p>
        
        <div class="space-y-4">
          <div class="flex items-start gap-4">
            <div class="h-6 w-6 rounded-full bg-brand/20 flex items-center justify-center text-brand text-xs font-bold mt-1">1</div>
            <div>
              <h4 class="text-white font-medium mb-1">{t('code.step1_title')}</h4>
              <p class="text-slate-500 text-sm">{t('code.step1_desc')}</p>
            </div>
          </div>
          <div class="flex items-start gap-4">
            <div class="h-6 w-6 rounded-full bg-brand/20 flex items-center justify-center text-brand text-xs font-bold mt-1">2</div>
            <div>
              <h4 class="text-white font-medium mb-1">{t('code.step2_title')}</h4>
              <p class="text-slate-500 text-sm">{t('code.step2_desc')}</p>
            </div>
          </div>
          <div class="flex items-start gap-4">
            <div class="h-6 w-6 rounded-full bg-brand/20 flex items-center justify-center text-brand text-xs font-bold mt-1">3</div>
            <div>
              <h4 class="text-white font-medium mb-1">{t('code.step3_title')}</h4>
              <p class="text-slate-500 text-sm">{t('code.step3_desc')}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-1 w-full max-w-2xl">
        <div class="bg-bg rounded-2xl overflow-hidden border border-white/10 shadow-2xl">
          <div class="flex items-center justify-between px-6 py-3 bg-white/5 border-b border-white/10">
            <div class="flex gap-2">
              <div class="w-3 h-3 rounded-full bg-red-500/20"></div>
              <div class="w-3 h-3 rounded-full bg-yellow-500/20"></div>
              <div class="w-3 h-3 rounded-full bg-green-500/20"></div>
            </div>
            <span class="text-xs text-slate-500 font-mono">rule_definition.json</span>
          </div>
          <div class="p-6 overflow-x-auto text-sm">
            <Code code={ruleCode} lang="json" theme="github-dark" />
          </div>
          
          <div class="px-6 py-3 bg-white/5 border-y border-white/10 flex items-center justify-between">
            <span class="text-xs text-slate-500 font-mono">execution_result.json</span>
            <span class="text-[10px] text-brand px-2 py-0.5 rounded-full bg-brand/10 font-mono">1.63 Âµs</span>
          </div>
          <div class="p-6 overflow-x-auto text-sm bg-black/20">
            <Code code={executionResult} lang="json" theme="github-dark" />
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style is:global>
  pre {
    background-color: transparent !important;
    padding: 0 !important;
    margin: 0 !important;
  }
</style>
